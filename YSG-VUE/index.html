<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">
    <meta http-equiv="Cache-Control" content="no-cache">
    <title>ASCOTT</title>
    <link rel="stylesheet" href="static/lib/swiper/swiper.min.css">
    <link rel="stylesheet" href="static/style.css">

    <link rel="stylesheet" href="static/ydui.css">
    <!--分页css-->
    <link rel="stylesheet" href="static/lib/pagination/page.css">

	<!--<script src="https://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/vconsole/2.5.1/vconsole.min.js"></script>-->
      <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan style='display:none' id='cnzz_stat_icon_1264443895'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1264443895' type='text/javascript'%3E%3C/script%3E"));</script>
      <script>
      </script>
  </head>
  <body>
      <div id="app" style="height: 100%;"></div>
      <div></div>
    <div id="shoppingPwd" class="mask-black" style="display: none;">
        <div class="m-keyboard keyboard-show">
            <div class="keyboard-head">
                <strong></strong>
            </div>
            <div class="keyboard-error"></div>
            <ul class="keyboard-password J_FillPwdBox">
                <li><i></i></li><li><i></i></li><li><i></i></li><li><i></i></li><li><i></i></li><li><i></i></li>
            </ul>
            <div style="text-align: right; padding: 0.15rem 0.8rem 0px;">
                <a href="#" class="J_ShowPwd" style="color: rgb(102, 102, 102); font-size: 0.24rem;"></a>
            </div>
            <div class="keyboard-content">
                <ul class="keyboard-numbers">
                    <li>
                        <a href="javascript:;" class="J_Nums">1</a>
                        <a href="javascript:;" class="J_Nums">2</a>
                        <a href="javascript:;" class="J_Nums">3</a>
                    </li>
                    <li>
                        <a href="javascript:;" class="J_Nums">4</a>
                        <a href="javascript:;" class="J_Nums">5</a>
                        <a href="javascript:;" class="J_Nums">6</a>
                    </li>
                    <li>
                        <a href="javascript:;" class="J_Nums">7</a>
                        <a href="javascript:;" class="J_Nums">8</a>
                        <a href="javascript:;" class="J_Nums">9</a>
                    </li>
                    <li>
                        <a href="javascript:;" class="J_Cancel"></a>
                        <a href="javascript:;" class="J_Nums">0</a>
                        <a href="javascript:;" class="J_Backspace"></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
          
      <script src="static/lib/ydui.flexible.js"></script>
      <script src="static/lib/jquery-3.1.1.min.js"></script>
      <script src="static/lib/swiper/swiper.min.js"></script>
      <script src="https://cdn.bootcss.com/blueimp-md5/1.1.0/js/md5.min.js"></script>
      <script src="static/JSBridge.js"></script>
      <script src="static/language.js"></script>
      <script src="static/ydui.js"></script>
      <script src="static/lib/jquery.qrcode.min.js"></script>
      <!--横向滚动菜单-->
      <script type="text/javascript" src="static/lib/mySwipe/flexible.js"></script>
      <script type="text/javascript" src="static/lib/mySwipe/iscroll.js"></script>
      <script type="text/javascript" src="static/lib/mySwipe/navbarscroll.js"></script>
      <!--分页js-->
      <script type="text/javascript" src="static/lib/pagination/pagination.js"></script>
      <script>
        //设置pin码
        function setPin(pdata){
            let _this = pdata;
            let dialog = window.YDUI.dialog;
            let alobj = new alertLanguage();
            let obj = alobj.getAlertMsg(localStorage.LANGUAGE);
            let sureBnt = obj.sureBnt;
            let pwdHtml = `<input id="pwdNum" type="number" oninput="if(value.length>6)value=value.slice(0,6)" style="width:100%;">`;
            let firstPwd = "";
            let resetBnt = '重置';
            let title = '请设置交易密码';
            let title1 = "请再次输入交易密码";
            let msg1 = "请输入6位数字!";
            let msg2 = "第一次密码与第二次不一致!";
            let msg3 = "设置成功!";
            let msg4 = "token过期，请重新登录!";
            //判断显示中/英文
            if(localStorage.LANGUAGE!='zh'){
                resetBnt = 'Reset';
                title = 'Please set transaction password';
                title1 = "Please enter transaction password again";
                msg1 = "Please enter 6 digits!";
                msg2 = "The first password is inconsistent with the second!";
                msg3 = "Successfully set up!";
                msg4 = "Token expired, please log in again!";
            }
            //判断是否设置交易密码
            let pinParams = {
                token: localStorage.TOKEN
            };
            _this.$store.dispatch('isSetPin', pinParams).then(function (res) {
                //是否设置pin码
                if(res.code == 1){
                    dialog.confirm(title,pwdHtml, [
                        {
                            txt: sureBnt,
                            color: false,
                            stay: true, //是否保留提示框
                            callback: function () {
                                let pwd = $("#pwdNum").val();
                                if(!/^[0-9]{6}$/.test(pwd)){
                                    dialog.alert(msg1);
                                    $("#pwdNum").val("");
                                    $("#pwdNum").focus();
                                }else{
                                    if(firstPwd == ""){
                                        firstPwd = pwd;
                                        $(".confirm-title").html(title1);
                                        $("#pwdNum").val("");
                                        $("#pwdNum").focus();
                                    }else{
                                        if(pwd!=firstPwd){
                                            dialog.alert(msg2);
                                            $("#pwdNum").val("");
                                            $("#pwdNum").focus();
                                        }else{
                                            dialog.loading.open('Loading');
                                            //设置密码
                                            let setParams = {
                                                token: localStorage.TOKEN,
                                                pin: firstPwd
                                            };
                                            _this.$store.dispatch('setPin', setParams).then(function (res) {
                                                if(res.code == 0){
                                                    dialog.alert(msg3);
                                                }else if(res.code == 1){
                                                    dialog.alert(msg4);
                                                }else{
                                                    dialog.alert(res.msg);
                                                }
                                                dialog.loading.close();
                                                $("#pwdNum").val("");
                                                $("#YDUI_CONFRIM").hide();
                                            });
                                        }
                                    }
                                }
                            }
                        },
                        {
                            txt: resetBnt,
                            color: false,
                            stay: true,
                            callback: function () {
                                firstPwd = "";
                                $("#pwdNum").val("");
                                $("#pwdNum").focus();
                                $(".confirm-title").html(title);
                            }
                        }
                    ]);
                    $("#pwdNum").focus();
                }else if(res.code == 2){
                    dialog.alert(msg4);
                }else if(res.code != 0){
                    dialog.alert(res.msg);
                }
            });
        }

        //验证pin码,并跳转页面
        function checkPin(_this,objParams){
            let pwd = '';
            let isShow = false;
            let titleNode = "请输入购物密码";
            let showPwdNode = "显示密码";
            let hidePwdNode = "隐藏密码";
            let cancelNode = "取消";
            let msg1 = "token过期，请重新登录";
            let msg2 = "密码错误";
            //判断显示中/英文
            if(localStorage.LANGUAGE!='zh'){
                titleNode = "Please enter the purchase password";
                showPwdNode = "Show password";
                hidePwdNode = "Hide password";
                cancelNode = "Cancel";
                msg1 = "Token expired, please log in again";
                msg2 = "Wrong password";
            }
            $("#shoppingPwd").show();
            $("#shoppingPwd .keyboard-head strong").html(titleNode);
            $("#shoppingPwd .J_ShowPwd").html(showPwdNode);
            $("#shoppingPwd .J_Cancel").html(cancelNode);
            $("#shoppingPwd .J_FillPwdBox li").html("");
            //点击密码数字
            $("#shoppingPwd .J_Nums").click(function(){
                if(pwd.length==6){
                    return;
                }
                let num = $(this).html();
                pwd = pwd+num;
                let numLength = pwd.length;
                if(isShow){
                    $("#shoppingPwd .J_FillPwdBox li:eq("+(numLength-1)+")").html(num);
                }else{
                    $("#shoppingPwd .J_FillPwdBox li:eq("+(numLength-1)+")").html("<i style='display:block;width:6px;height:6px;border-radius:50%;background-color:#000;'></i>");
                }
                if(numLength==6){
                    let dialog = window.YDUI.dialog;
                    //设置密码
                    dialog.loading.open('Loading');
                    let pinParams = {
                        token: localStorage.TOKEN,
                        pin: pwd
                    };
                    _this.$store.dispatch('checkPin', pinParams).then(function (res) {
                        dialog.loading.close();
                        pwd = '';
                        $("#shoppingPwd .J_FillPwdBox li").html("");
                        if(res.code == 0){
                            $("#shoppingPwd").hide();
                            if(objParams != undefined){
                                _this.$router.push(objParams);
                            }
                        }else if(res.code == 1){
                            $("#shoppingPwd .keyboard-error").html(msg1);
                            $("#shoppingPwd").hide();
                        }else if(res.code == 2){
                            $("#shoppingPwd .keyboard-error").html(msg2);
                        }else{
                            $("#shoppingPwd .keyboard-error").html(res.msg);
                            $("#shoppingPwd").hide();
                        }
                    });
                }
            });
            //点击取消按钮
            $("#shoppingPwd .J_Cancel").click(function(){
                $("#shoppingPwd").hide();
            });
            //点击删除按钮
            $("#shoppingPwd .J_Backspace").click(function(){
                if(pwd.length==0){
                    return;
                }
                pwd = pwd.substring(0,pwd.length-1);
                $("#shoppingPwd .J_FillPwdBox li:eq("+pwd.length+")").html("");
            });
            //点击显示密码按钮
            $("#shoppingPwd .J_ShowPwd").click(function(){
                isShow = !isShow;
                if(isShow){
                    for(let i=0;i<pwd.length;i++){
                        $("#shoppingPwd .J_FillPwdBox li:eq("+i+")").html(pwd[i]);
                    }
                    $(this).html(hidePwdNode);
                }else{
                    for(let i=0;i<pwd.length;i++){
                        $("#shoppingPwd .J_FillPwdBox li:eq("+i+")").html("<i style='display:block;width:6px;height:6px;border-radius:50%;background-color:#000;'></i>");
                    }
                    $(this).html(showPwdNode);
                }
            });
        }
        //获取字体大小
        $(function(){
            let cssFontSize = $("html").css("font-size");
            $(window).resize(function() {
                setTimeout(function(){
                    $("html").css("font-size",cssFontSize);
                },300);
            });
        });
      </script>
  </body>
</html>
